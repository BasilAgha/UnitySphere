<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - VR Therapy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Your CSS (already uploaded to your project / web host) -->
  <link rel="stylesheet" href="base.css" />
  <link rel="stylesheet" href="../ui-shell.css" />
  <link rel="stylesheet" href="dashboard.css" />
</head>
<body class="dashboard-page">
  <div class="ui-shell">
    <aside id="appSidebar"></aside>
    <header id="appHeader"></header>
    <main class="shell-content">
      <!-- ===== DASHBOARD SECTION ===== -->
      <section id="section-dashboard" class="section active">
        <div class="section-header">
          <div>
            <h2>Dashboard</h2>
            <p class="hint">Welcome back, <span id="welcomeName">Admin</span>. Here is the system pulse.</p>
          </div>
          <div class="section-actions">
            <button class="ghost" id="refreshDashboardBtn" type="button">Refresh KPIs</button>
          </div>
        </div>

        <div class="card-grid kpi-grid">
          <div class="card kpi-card">
            <div class="kpi-label">Centers</div>
            <div class="kpi-value" id="statCenters">0</div>
            <div class="kpi-sub" id="statCentersHint">Active VR therapy hubs</div>
          </div>
          <div class="card kpi-card">
            <div class="kpi-label">Specialists</div>
            <div class="kpi-value" id="statSpecialists">0</div>
            <div class="kpi-sub" id="statSpecialistsHint">Clinical workforce online</div>
          </div>
          <div class="card kpi-card">
            <div class="kpi-label">Kids</div>
            <div class="kpi-value" id="statChildren">0</div>
            <div class="kpi-sub">Participants in active programs</div>
          </div>
          <div class="card kpi-card">
            <div class="kpi-label">VR Modules</div>
            <div class="kpi-value" id="statModules">0</div>
            <div class="kpi-sub">Live therapy experiences</div>
          </div>
        </div>

        <div class="card-grid dashboard-grid two-up">
          <div class="card chart-card">
            <div class="card-header">
              <h3>Children per Center</h3>
            </div>
            <canvas id="childrenPerCenterChart" height="110"></canvas>
          </div>
          <div class="card chart-card">
            <div class="card-header">
              <h3>Specialists per Center</h3>
            </div>
            <canvas id="specialistsPerCenterChart" height="110"></canvas>
          </div>
        </div>
        <div class="card-grid dashboard-grid two-up">
          <div class="card chart-card">
            <div class="card-header">
              <h3>Most-used VR Modules</h3>
            </div>
            <canvas id="modulesUsageChart" height="110"></canvas>
          </div>
          <div class="card chart-card">
            <div class="card-header">
              <h3>Recent Activity Timeline</h3>
            </div>
            <canvas id="auditTimelineChart" height="110"></canvas>
          </div>
        </div>
      </section>

      <!-- ===== CENTERS SECTION ===== -->
      <section id="section-centers" class="section">
        <div class="section-header">
          <div>
            <h2>Centers</h2>
            <p class="hint">Manage centers, their credentials, and basic stats.</p>
          </div>
          <div class="section-actions">
            <button class="primary with-icon" id="btnAddCenter">
              <span class="icon">+</span>
              <span class="label">Add Center</span>
            </button>
          </div>
        </div>
        <div class="section-filter-tabs" data-section-filter="centers">
          <button class="pill small filter-tab active" type="button" data-section="centers" data-status="active">Active</button>
          <button class="pill small filter-tab" type="button" data-section="centers" data-status="deleted">Deleted</button>
        </div>

        <div class="card">
          <div class="center-directory">
            <div class="directory-header">
              <h3>All Centers</h3>
              <span class="hint" id="centersCountHint">0 centers</span>
            </div>

            <div class="card-grid" id="centersGrid">
              <!-- Centers will be rendered here as .center-card -->
            </div>

            <div class="empty-state" id="centersEmpty" style="display:none;">
              <div class="empty-title">No centers yet</div>
              <div>No center profiles have been created yet. Add a center to start onboarding specialists and children.</div>
              <div class="empty-actions">
                <button class="ghost small" id="centersEmptyAdd">Add Center</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== SPECIALISTS SECTION ===== -->
      <section id="section-specialists" class="section">
        <div class="section-header">
          <div>
            <h2>Specialists</h2>
            <p class="hint">Manage freelance and center-linked specialists.</p>
          </div>
          <div class="section-actions">
            <button class="primary with-icon" id="btnAddSpecialist">
              <span class="icon">+</span>
              <span class="label">Add Specialist</span>
            </button>
          </div>
        </div>
        <div class="card-subsection">
          <div class="grid-2-col">
            <div class="input-group">
              <label for="specialistCenterFilter">Center</label>
              <select id="specialistCenterFilter">
                <option value="">All centers</option>
              </select>
            </div>
          </div>
        </div>
        <div class="section-filter-tabs" data-section-filter="specialists">
          <button class="pill small filter-tab active" type="button" data-section="specialists" data-status="active">Active</button>
          <button class="pill small filter-tab" type="button" data-section="specialists" data-status="deleted">Deleted</button>
        </div>

        <div class="specialists-grid flip-grid" id="specialistsGrid">
          <!-- Specialist flip cards here -->
        </div>

        <div class="empty-state" id="specialistsEmpty" style="display:none;">
          <div class="empty-title">No specialists yet</div>
          <div>There are no specialists on record. Add a specialist to begin assigning children and sessions.</div>
          <div class="empty-actions">
            <button class="ghost small" id="specialistsEmptyAdd">Add Specialist</button>
          </div>
        </div>
      </section>

      <!-- ===== CHILDREN SECTION ===== -->
      <section id="section-children" class="section">
        <div class="section-header">
          <div>
            <h2>Children</h2>
            <p class="hint">Monitor children across all centers and specialists.</p>
          </div>
        </div>
        <div class="card-subsection">
          <div class="grid-2-col">
            <div class="input-group">
              <label for="childNameFilter">Name</label>
              <input id="childNameFilter" type="text" placeholder="Search child name" />
            </div>
            <div class="input-group">
              <label for="childCenterFilter">Center</label>
              <select id="childCenterFilter">
                <option value="">All centers</option>
              </select>
            </div>
            <div class="input-group">
              <label for="childSpecialistFilter">Specialist</label>
              <select id="childSpecialistFilter">
                <option value="">All specialists</option>
              </select>
            </div>
            <div class="input-group">
              <label for="childStatusFilter">Status</label>
              <select id="childStatusFilter">
                <option value="">All</option>
                <option value="active">Active</option>
                <option value="deleted">Deleted</option>
              </select>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="modules-grid" id="childrenGrid">
            <!-- Children cards -->
          </div>

          <div class="empty-state" id="childrenEmpty" style="display:none;">
            <div class="empty-title">No children yet</div>
            <div>Children appear here once specialists begin onboarding.</div>
          </div>

          <div id="childrenTableWrap"></div>
        </div>
      </section>

      <!-- ===== VR MODULES SECTION ===== -->
      <section id="section-vr-modules" class="section">
        <div class="section-header">
          <div>
            <h2>VR Modules</h2>
            <p class="hint">Manage VR modules available to centers.</p>
          </div>
          <div class="section-actions">
            <button class="primary with-icon" id="btnAddModule">
              <span class="icon">+</span>
              <span class="label">Add Module</span>
            </button>
          </div>
        </div>
        <div class="section-filter-tabs" data-section-filter="vr-modules">
          <button class="pill small filter-tab active" type="button" data-section="vr-modules" data-status="active">Active</button>
          <button class="pill small filter-tab" type="button" data-section="vr-modules" data-status="deleted">Deleted</button>
        </div>

        <div class="modules-grid module-grid" id="modulesGrid">
          <!-- Module cards -->
        </div>

        <div class="empty-state" id="modulesEmpty" style="display:none;">
          <div class="empty-title">No VR modules yet</div>
          <div>Modules are training experiences assignable to centers. Add a module to start distributing content.</div>
          <div class="empty-actions">
            <button class="ghost small" id="modulesEmptyAdd">Add Module</button>
          </div>
        </div>
      </section>

      <!-- ===== ASSESSMENT SECTION ===== -->
      <section id="section-assessment" class="section">
        <div class="section-header">
          <div>
            <h2>Assessment</h2>
            <p class="hint">Monitor child performance snapshots across centers.</p>
          </div>
        </div>

        <div class="assessment-shell">
          <div class="card assessment-selector">
            <label for="assessmentChildSearch" class="hint">Child</label>
            <div class="assessment-search-row">
              <div class="child-dropdown">
                <input id="assessmentChildSearch" type="search" placeholder="Search child name" autocomplete="off" />
                <div id="assessmentChildList" class="child-dropdown-list" role="listbox" aria-label="Children list"></div>
              </div>
              <select id="assessmentChildSelect" class="child-select" aria-label="Select child">
                <option value="">Select child</option>
              </select>
            </div>
          </div>

          <div class="card assessment-empty" id="assessmentEmptyCard">
            <div class="empty-text">Select a child to view assessment</div>
          </div>

          <div class="assessment-details" id="assessmentDetails" style="display:none;">
            <div class="card assessment-profile">
              <div class="profile-card">
                <div class="avatar profile-avatar" id="assessmentChildAvatar" data-initials="CH"></div>
                <div>
                  <div class="profile-name" id="assessmentChildName">Child Name</div>
                  <div class="profile-meta">
                    <span id="assessmentChildAge">Age: --</span>
                    <span id="assessmentChildCenter">Center: --</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="card assessment-chart">
              <div class="card-header">
                <h3>Performance Overview</h3>
              </div>
              <canvas id="assessmentRadarChart" height="200"></canvas>
            </div>
            <div class="card assessment-chart">
              <div class="card-header">
                <h3>Progress Over Time</h3>
              </div>
              <canvas id="assessmentProgressChart" height="200"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== SETTINGS SECTION ===== -->
      <section id="section-settings" class="section">
        <div class="section-header">
          <div>
            <h2>Settings</h2>
            <p class="hint">Account preferences and workspace controls.</p>
          </div>
        </div>
        <div class="card-grid settings-grid">
          <div class="card settings-card">
            <div class="card-header">
              <h3>Profile Summary</h3>
            </div>
            <div class="profile-card">
              <div class="avatar profile-avatar" id="settingsAvatar" data-initials="US"></div>
              <div>
                <div class="profile-name" id="settingsProfileName">Admin</div>
                <div class="profile-meta">
                  <span id="settingsProfileRole">Role: Admin</span>
                  <span id="settingsProfileCenter">Center: --</span>
                </div>
              </div>
            </div>
            <div class="settings-actions">
              <button class="ghost" id="accountSettingsBtn">Account Settings</button>
              <button class="ghost" id="refreshAllBtn">Refresh data</button>
              <button class="ghost" id="logoutBtn">Log out</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- ========= MODALS ========= -->

  <!-- Center Modal -->
  <div class="modal-backdrop" id="centerModal">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h2 id="centerModalTitle">Add Center</h2>
          <p class="modal-subtitle">Create or update a center profile.</p>
        </div>
        <button class="icon-button" data-close-modal="centerModal">x</button>
      </div>
      <div class="form-panel">
        <input type="hidden" id="centerId" />
        <input type="hidden" id="centerPhotoInput" />
        <div class="photo-input">
          <div class="avatar preview avatar-static" id="centerPhotoPreview"></div>
          <div class="input-group">
            <label for="centerPhotoFile">Photo</label>
            <input id="centerPhotoFile" type="file" accept="image/*" />
            <p class="hint">Upload a center photo (optional).</p>
          </div>
        </div>
        <input type="hidden" id="centerCoverInput" />
        <div class="photo-input">
          <div class="cover preview" id="centerCoverPreview"></div>
          <div class="input-group">
            <label for="centerCoverFile">Cover</label>
            <input id="centerCoverFile" type="file" accept="image/*" />
            <p class="hint">Upload a center cover photo (optional).</p>
          </div>
        </div>
        <div class="input-group">
          <label for="centerNameInput">Name</label>
          <input id="centerNameInput" type="text" placeholder="Center name" />
        </div>
        <div class="input-group">
          <label for="centerUsernameInput">Username</label>
          <input id="centerUsernameInput" type="text" placeholder="Login username" />
        </div>
        <div class="input-group">
          <label for="centerPasswordInput">Password</label>
          <input id="centerPasswordInput" type="password" placeholder="Login password" />
        </div>
        <div class="input-group">
          <label for="centerDescInput">Description</label>
          <textarea id="centerDescInput" rows="3" placeholder="Short description"></textarea>
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" data-close-modal="centerModal">Cancel</button>
        <button class="primary" id="centerSaveBtn">Save Center</button>
      </div>
    </div>
  </div>

  <!-- Specialist Modal -->
  <div class="modal-backdrop" id="specialistModal">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h2 id="specialistModalTitle">Add Specialist</h2>
          <p class="modal-subtitle">Create or update a specialist profile.</p>
        </div>
        <button class="icon-button" data-close-modal="specialistModal">x</button>
      </div>
      <div class="form-panel">
        <input type="hidden" id="specId" />
        <input type="hidden" id="specPhotoInput" />
        <div class="photo-input">
          <div class="avatar preview avatar-static" id="specPhotoPreview"></div>
          <div class="input-group">
            <label for="specPhotoFile">Photo</label>
            <input id="specPhotoFile" type="file" accept="image/*" />
            <p class="hint">Upload a profile photo (optional).</p>
          </div>
        </div>
        <div class="input-group">
          <label for="specNameInput">Name</label>
          <input id="specNameInput" type="text" placeholder="Specialist name" />
        </div>
        <div class="input-group">
          <label for="specUsernameInput">Username</label>
          <input id="specUsernameInput" type="text" placeholder="Login username" />
        </div>
        <div class="input-group">
          <label for="specPasswordInput">Password</label>
          <input id="specPasswordInput" type="password" placeholder="Login password" />
        </div>
        <div class="input-group">
          <label for="specTypeInput">Type</label>
          <select id="specTypeInput">
            <option value="freelance">Freelance</option>
            <option value="center">Linked to center</option>
          </select>
        </div>
        <div class="input-group">
          <label for="specCenterIdInput">Center (if linked)</label>
          <select id="specCenterIdInput" disabled>
            <option value="">Select a center</option>
          </select>
        </div>
        <div class="input-group">
          <label for="specDescInput">Description</label>
          <textarea id="specDescInput" rows="3" placeholder="Specialist description"></textarea>
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" data-close-modal="specialistModal">Cancel</button>
        <button class="primary" id="specialistSaveBtn">Save Specialist</button>
      </div>
    </div>
  </div>

  <!-- Module Modal -->
  <div class="modal-backdrop" id="moduleModal">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h2 id="moduleModalTitle">Add Module</h2>
          <p class="modal-subtitle">Create or update a VR module.</p>
        </div>
        <button class="icon-button" data-close-modal="moduleModal">x</button>
      </div>
      <div class="form-panel">
        <input type="hidden" id="moduleId" />
        <div class="input-group">
          <label for="modNameInput">Name</label>
          <input id="modNameInput" type="text" placeholder="Module name" />
        </div>
        <input type="hidden" id="modulePhotoInput" />
        <div class="photo-input">
          <div class="avatar preview avatar-static" id="modulePhotoPreview"></div>
          <div class="input-group">
            <label for="modulePhotoFile">Thumbnail</label>
            <input id="modulePhotoFile" type="file" accept="image/*" />
            <p class="hint">Upload a module thumbnail (optional).</p>
          </div>
        </div>
        <div class="input-group">
          <label for="modMinutesInput">Minutes to play</label>
          <input id="modMinutesInput" type="number" min="1" placeholder="Duration (minutes)" />
        </div>
        <div class="input-group">
          <label for="modDescInput">Description</label>
          <textarea id="modDescInput" rows="3" placeholder="Short description"></textarea>
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" data-close-modal="moduleModal">Cancel</button>
        <button class="primary" id="moduleSaveBtn">Save Module</button>
      </div>
    </div>
  </div>

  <!-- Question Modal -->
  <div class="modal-backdrop" id="questionModal">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h2 id="questionModalTitle">Add Question</h2>
          <p class="modal-subtitle">Create or update an assessment question.</p>
        </div>
        <button class="icon-button" data-close-modal="questionModal">x</button>
      </div>
      <div class="form-panel">
        <input type="hidden" id="questionId" />
        <div class="input-group">
          <label for="qTextInput">Question Text</label>
          <textarea id="qTextInput" rows="3" placeholder="Write the question here"></textarea>
        </div>
        <div class="input-group">
          <label for="qCategoryInput">Category</label>
          <input id="qCategoryInput" type="text" placeholder="Optional category" />
        </div>
        <div class="input-group">
          <label for="qDifficultyInput">Difficulty</label>
          <input id="qDifficultyInput" type="text" placeholder="Optional difficulty (e.g., Easy, Medium)" />
        </div>
        <div class="input-group">
          <label for="qStatusInput">Status</label>
          <select id="qStatusInput">
            <option value="active">Active</option>
            <option value="archived">Archived</option>
          </select>
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" data-close-modal="questionModal">Cancel</button>
        <button class="primary" id="questionSaveBtn">Save Question</button>
      </div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div class="modal-backdrop" id="confirmModal">
    <div class="modal confirm-modal">
      <div class="modal-header">
        <div>
          <h2 id="confirmTitle">Confirm action</h2>
          <p class="modal-subtitle" id="confirmMessage">Are you sure?</p>
        </div>
        <button class="icon-button" data-close-modal="confirmModal">x</button>
      </div>
      <div class="modal-actions confirm-actions">
        <button class="ghost" id="confirmCancel">Cancel</button>
        <button class="primary danger" id="confirmOk">Yes, proceed</button>
      </div>
    </div>
  </div>

  <!-- Account Settings Modal -->
  <div class="modal-backdrop" id="accountModal">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h2>Account Settings</h2>
          <p class="modal-subtitle">Update your display name and photo.</p>
        </div>
        <button class="icon-button" data-close-modal="accountModal">x</button>
      </div>
      <div class="form-panel">
        <input type="hidden" id="accountPhotoInput" />
        <div class="photo-input">
          <div class="avatar preview avatar-static" id="accountPhotoPreview"></div>
          <div class="input-group">
            <label for="accountPhotoFile">Photo</label>
            <input id="accountPhotoFile" type="file" accept="image/*" />
            <p class="hint">Upload a profile photo (optional).</p>
          </div>
        </div>
        <div class="input-group">
          <label for="accountNameInput">Display name</label>
          <input id="accountNameInput" type="text" placeholder="Your name" />
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" data-close-modal="accountModal">Cancel</button>
        <button class="primary" id="accountSaveBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- Child Profile Modal -->
  <div class="modal-backdrop" id="adminChildProfileModal">
    <div class="modal">
      <div class="modal-header">
        <div>
          <h2 id="adminChildProfileTitle">Child Profile</h2>
          <p class="modal-subtitle" id="adminChildProfileSubtitle"></p>
        </div>
        <button class="icon-button" data-close-modal="adminChildProfileModal">x</button>
      </div>
      <div class="form-panel">
        <div class="card-subsection">
          <div class="profile-card">
            <div class="avatar profile-avatar" id="adminChildProfileAvatar" data-initials="CH"></div>
            <div>
              <div class="profile-name" id="adminChildProfileName">Child</div>
              <div class="profile-meta">
                <span id="adminChildProfileAge">Age: --</span>
                <span id="adminChildProfileCenter">Center: --</span>
              </div>
            </div>
          </div>
        </div>
        <div class="card-subsection">
          <div class="card chart-card">
            <div class="card-header">
              <h3>Progress Overview</h3>
            </div>
            <canvas id="adminChildProgressChart" height="160"></canvas>
          </div>
        </div>
        <div class="card-subsection">
          <div class="panel">
            <div class="panel-header">
              <strong>Sessions</strong>
            </div>
            <div class="stacked-list" id="adminChildSessionsList"></div>
          </div>
        </div>
        <div class="card-subsection">
          <div class="panel">
            <div class="panel-header">
              <strong>Assessments</strong>
            </div>
            <div class="stacked-list" id="adminChildAssessmentsList"></div>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="ghost" data-close-modal="adminChildProfileModal">Close</button>
      </div>
    </div>
  </div>

  <script src="../ui-shell.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="admin.js"></script>
</body>
</html>
